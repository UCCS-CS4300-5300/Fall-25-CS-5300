{% extends "base.html" %}
{% load static %}

{% block title %}Delete Account - Active Interview Service{% endblock title %}

{% block content %}
<div class="container-page container-narrow container-centered">
  <div class="box box-section">
    <div class="text-center mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="var(--error)" class="bi bi-exclamation-triangle mb-3" viewBox="0 0 16 16">
        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
      </svg>
      <h1 style="color: var(--error);">Delete My Account</h1>
      <p class="text-secondary-color">Permanently delete your account and all data</p>
    </div>

    <div class="box" style="background: var(--error); color: var(--text-white); border: 2px solid var(--error); padding: 1.5rem; margin-bottom: 1.5rem;">
      <h3 class="text-lg text-bold mb-3">‚ö†Ô∏è Warning: This Action is Permanent!</h3>
      <p class="mb-2">
        Deleting your account will permanently and irreversibly remove your data.
        This action <strong>CANNOT BE UNDONE</strong>.
      </p>
      <p class="mb-0">
        Please read the following information carefully before proceeding.
      </p>
    </div>

    <!-- What Will Be Deleted -->
    <div class="box" style="background: var(--surface); border: 2px solid var(--border); padding: 1.5rem; margin-bottom: 1.5rem;">
      <h3 class="text-lg text-bold mb-3" style="color: var(--error);">What will be deleted:</h3>
      <ul class="mb-0">
        <li><strong>Profile Information:</strong> Username, email, personal details</li>
        <li><strong>{{ resume_count }} Resume(s):</strong> All uploaded resume files and content</li>
        <li><strong>{{ job_count }} Job Listing(s):</strong> All job postings you've uploaded</li>
        <li><strong>{{ interview_count }} Interview(s):</strong> All chat transcripts and messages</li>
        <li><strong>Audio Recordings:</strong> Any voice recordings from interviews</li>
        <li><strong>Templates:</strong> Your custom interview templates</li>
        <li><strong>Account Access:</strong> You will no longer be able to log in</li>
      </ul>
    </div>

    <!-- What Will Be Retained -->
    <div class="box box-info mb-4">
      <h3 class="text-lg text-bold mb-3">What will be retained (anonymized):</h3>
      <p class="text-sm mb-2">
        For analytics and legal compliance, we will retain:
      </p>
      <ul class="text-sm mb-0">
        <li><strong>Interview Scores:</strong> Performance metrics (no personal details)</li>
        <li><strong>Statistics:</strong> Anonymized usage data for platform improvement</li>
        <li><strong>Audit Trail:</strong> Deletion timestamp and anonymized user ID</li>
      </ul>
      <p class="text-sm mt-2 mb-0">
        <strong>Note:</strong> All retained data is completely anonymized and cannot be linked back to you.
      </p>
    </div>

    <!-- Alternative: Export First -->
    <div class="box" style="background: var(--warning); color: var(--text-primary); border: 2px solid var(--warning); padding: 1.5rem; margin-bottom: 1.5rem;">
      <h3 class="text-lg text-bold mb-2">üí° Consider Exporting First</h3>
      <p class="text-sm mb-2">
        Before deleting your account, you may want to download a copy of your data.
      </p>
      <a href="{% url 'request_data_export' %}" class="btn btn-secondary">
        Export My Data First
      </a>
    </div>

    <!-- Your Account Info -->
    <div class="box" style="background: var(--surface-hover); border: 2px solid var(--border); padding: 1rem; margin-bottom: 1.5rem;">
      <h3 class="text-lg text-bold mb-3">Account to be deleted:</h3>
      <div class="info-item mb-2">
        <div class="info-label">Username</div>
        <div class="info-value">{{ user.username }}</div>
      </div>
      <div class="info-item mb-2">
        <div class="info-label">Email</div>
        <div class="info-value">{{ user.email }}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Member Since</div>
        <div class="info-value">{{ user.date_joined|date:"F d, Y" }}</div>
      </div>
    </div>

    <!-- Confirmation Form -->
    <form method="post">
      {% csrf_token %}
      <div class="mb-4">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="confirmCheck" required>
          <label class="form-check-label" for="confirmCheck">
            <strong>I understand that this action is permanent and cannot be undone</strong>
          </label>
        </div>
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="dataCheck" required>
          <label class="form-check-label" for="dataCheck">
            <strong>I understand that all my personal data will be permanently deleted</strong>
          </label>
        </div>
      </div>

      <div class="d-flex flex-column gap-2">
        <button type="submit" class="btn btn-danger" id="deleteButton" disabled>
          Proceed to Delete Account
        </button>
        <a href="{% url 'user_data_settings' %}" class="btn btn-secondary">Cancel - Keep My Account</a>
      </div>
    </form>
  </div>
</div>

<script>
  // Enable delete button only when both checkboxes are checked
  const confirmCheck = document.getElementById('confirmCheck');
  const dataCheck = document.getElementById('dataCheck');
  const deleteButton = document.getElementById('deleteButton');

  function updateButtonState() {
    if (confirmCheck.checked && dataCheck.checked) {
      deleteButton.disabled = false;
    } else {
      deleteButton.disabled = true;
    }
  }

  confirmCheck.addEventListener('change', updateButtonState);
  dataCheck.addEventListener('change', updateButtonState);
</script>

<style>
  .container-centered {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60vh;
    padding: 2rem 1rem;
  }

  .box-section {
    background: var(--surface-hover);
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    padding: 2rem;
    max-width: 700px;
    width: 100%;
  }

  .box-info {
    background: var(--surface);
    border: 2px solid var(--info);
    border-radius: var(--radius);
    padding: 1rem;
  }

  .info-item {
    padding: 0.75rem;
    background: var(--surface);
    border-radius: var(--radius);
    border-left: 3px solid var(--error);
  }

  .info-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
  }

  .info-value {
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 500;
  }

  .btn-danger {
    background-color: var(--error);
    color: var(--text-white);
    border: none;
    padding: 0.75rem 2rem;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-danger:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  .btn-danger:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .form-check-input {
    background-color: var(--surface) !important;
    border-color: var(--border) !important;
  }

  .form-check-input:checked {
    background-color: var(--error) !important;
    border-color: var(--error) !important;
  }

  .form-check-label {
    color: var(--text-primary);
    font-size: 0.95rem;
  }
</style>
{% endblock content %}
