{% extends "base.html" %}
{% load static %}

{% block title %}Data Settings - Active Interview Service{% endblock title %}

{% block content %}
<div class="container-page container-standard">
  <div class="page-header">
    <h1>Privacy & Data Settings</h1>
    <p class="text-secondary-color">Manage your personal data and privacy preferences</p>
  </div>

  <!-- Data Export Section -->
  <div class="box box-section mb-4">
    <h2>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
      </svg>
      Export My Data
    </h2>
    <p class="text-secondary-color mb-3">
      Download a complete copy of your personal data, including profile information,
      interview transcripts, resumes, and scores in JSON and CSV formats.
    </p>

    {% if has_pending_export %}
      <div class="box box-info mb-3">
        <p class="text-bold mb-1">Export In Progress</p>
        <p class="text-sm mb-0">You have a pending data export request. Check the status below.</p>
      </div>
    {% endif %}

    {% if recent_exports %}
      <h3 class="text-lg text-bold mb-3">Recent Exports</h3>
      <div class="list-items mb-3">
        {% for export in recent_exports %}
          <div class="box box-item">
            <div>
              <p class="text-bold mb-1">
                Export Request
                {% if export.status == 'completed' %}
                  <span class="badge bg-success">Ready</span>
                {% elif export.status == 'processing' %}
                  <span class="badge bg-info">Processing</span>
                {% elif export.status == 'pending' %}
                  <span class="badge bg-warning">Pending</span>
                {% elif export.status == 'expired' %}
                  <span class="badge bg-secondary">Expired</span>
                {% else %}
                  <span class="badge bg-danger">Failed</span>
                {% endif %}
              </p>
              <p class="text-sm text-secondary-color mb-0">
                Requested: {{ export.requested_at|date:"M d, Y \a\t g:i A" }}
                {% if export.expires_at %}
                  | Expires: {{ export.expires_at|date:"M d, Y" }}
                {% endif %}
              </p>
            </div>
            <div>
              <a href="{% url 'data_export_status' export.id %}" class="btn btn-card">View Status</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" action="{% url 'request_data_export' %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary" {% if has_pending_export %}disabled{% endif %}>
        Request Data Export
      </button>
    </form>

    <div class="mt-3 box box-info">
      <p class="text-sm mb-1"><strong>What's included:</strong></p>
      <ul class="text-sm mb-0">
        <li>Profile information and account details</li>
        <li>All interview transcripts and performance scores</li>
        <li>Uploaded resumes and job listings</li>
        <li>Interview templates and role requests</li>
      </ul>
      <p class="text-sm mt-2 mb-0">
        <strong>Note:</strong> Export files are available for 7 days after generation.
      </p>
    </div>
  </div>

  <!-- Account Deletion Section -->
  <div class="box box-section">
    <h2 style="color: var(--error);">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
      </svg>
      Delete My Account
    </h2>
    <p class="text-secondary-color mb-3">
      Permanently delete your account and all associated data. This action cannot be undone.
    </p>

    <div class="box" style="background-color: var(--error); color: var(--text-white); border: 2px solid var(--error); padding: 1rem; margin-bottom: 1rem;">
      <p class="text-bold mb-2">⚠️ Warning: This is permanent!</p>
      <p class="text-sm mb-0">
        Deleting your account will permanently remove all your personal data, including
        interviews, resumes, and account information. Interview scores will be anonymized
        and retained for analytics purposes only.
      </p>
    </div>

    <a href="{% url 'request_account_deletion' %}" class="btn btn-danger">
      Delete My Account
    </a>
  </div>
</div>

<style>
  /* Ensure proper theming */
  .box-section {
    background: var(--surface-hover);
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    padding: 2rem;
  }

  .box-section h2 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .box-item {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .box-info {
    background: var(--surface);
    border: 2px solid var(--info);
    border-radius: var(--radius);
    padding: 1rem;
  }

  .badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 500;
  }

  .btn-danger {
    background-color: var(--error);
    color: var(--text-white);
    border: none;
    padding: 0.75rem 2rem;
    border-radius: var(--radius);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-danger:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }
</style>
{% endblock content %}
