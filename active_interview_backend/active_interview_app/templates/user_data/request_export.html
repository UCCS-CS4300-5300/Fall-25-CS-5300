{% extends "base.html" %}
{% load static %}
{% block title %}
  Request Data Export - Active Interview Service
{% endblock title %}
{% block content %}
  <div class="container-page container-narrow container-centered">
    <div class="box box-section">
      <div class="text-center mb-4">
        <svg xmlns="http://www.w3.org/2000/svg"
             width="64"
             height="64"
             fill="var(--primary)"
             class="bi bi-download mb-3"
             viewBox="0 0 16 16">
          <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
          <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
        </svg>
        <h1 class="text-brand">Request Data Export</h1>
        <p class="text-secondary-color">Export a complete copy of your personal data</p>
      </div>
      <div class="box box-info mb-4">
        <h3 class="text-lg text-bold mb-3">What will be included:</h3>
        <ul class="text-sm mb-0">
          <li>Profile information (username, email, role)</li>
          <li>All interview transcripts and messages</li>
          <li>Performance scores and feedback</li>
          <li>Uploaded resumes with parsed data</li>
          <li>Job listings</li>
          <li>Interview templates</li>
          <li>Role change requests</li>
        </ul>
      </div>
      <div class="box"
           style="background: var(--surface);
                  border: 2px solid var(--border);
                  padding: 1rem;
                  margin-bottom: 1.5rem">
        <h3 class="text-lg text-bold mb-2">Export Format:</h3>
        <p class="text-sm mb-2">Your data will be packaged as a ZIP file containing:</p>
        <ul class="text-sm mb-0">
          <li>
            <strong>complete_data.json</strong> - All data in one JSON file
          </li>
          <li>
            <strong>*.csv files</strong> - Tabular data in CSV format
          </li>
          <li>
            <strong>Folders</strong> - Organized by data type (resumes, interviews, etc.)
          </li>
          <li>
            <strong>README.txt</strong> - Guide to the export contents
          </li>
        </ul>
      </div>
      <div class="box box-info mb-4">
        <p class="text-sm mb-2">
          <strong>üìß Email Notification</strong>
        </p>
        <p class="text-sm mb-0">
          You will receive an email at <strong>{{ user.email }}</strong> when your export is ready.
          The download link will expire after 7 days.
        </p>
      </div>
      <div class="box"
           style="background: var(--warning);
                  color: var(--text-primary);
                  border: 2px solid var(--warning);
                  padding: 1rem;
                  margin-bottom: 1.5rem">
        <p class="text-bold mb-2">‚è±Ô∏è Processing Time</p>
        <p class="text-sm mb-0">
          Export processing typically completes within 5 minutes for most accounts.
          Larger datasets may take longer.
        </p>
      </div>
      <form method="post">
        {% csrf_token %}
        <div class="d-flex gap-2 justify-content-center">
          <a href="{% url 'user_data_settings' %}" class="btn btn-secondary">Cancel</a>
          <button type="submit" class="btn btn-primary">Confirm Export Request</button>
        </div>
      </form>
      {% if recent_exports %}
        <hr style="margin: 2rem 0;
                   border: none;
                   height: 2px;
                   background: linear-gradient(to right, transparent, var(--border), transparent)">
        <h3 class="text-lg text-bold mb-3">Your Recent Exports</h3>
        <div class="list-items">
          {% for export in recent_exports %}
            <div class="box box-item">
              <div>
                <p class="text-bold mb-1">
                  {{ export.requested_at|date:"M d, Y" }}
                  {% if export.status == 'completed' %}
                    <span class="badge bg-success">Ready</span>
                  {% elif export.status == 'processing' %}
                    <span class="badge bg-info">Processing</span>
                  {% elif export.status == 'pending' %}
                    <span class="badge bg-warning">Pending</span>
                  {% elif export.status == 'expired' %}
                    <span class="badge bg-secondary">Expired</span>
                  {% else %}
                    <span class="badge bg-danger">Failed</span>
                  {% endif %}
                </p>
                <p class="text-sm text-secondary-color mb-0">
                  {% if export.expires_at %}Expires: {{ export.expires_at|date:"M d, Y" }}{% endif %}
                </p>
              </div>
              <div>
                <a href="{% url 'data_export_status' export.id %}" class="btn btn-card">View</a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
  <style>
  .container-centered {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60vh;
  }

  .box-section {
    background: var(--surface-hover);
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    padding: 2rem;
  }

  .box-info {
    background: var(--surface);
    border: 2px solid var(--info);
    border-radius: var(--radius);
    padding: 1rem;
  }

  .box-item {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .list-items {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 500;
  }
  </style>
{% endblock content %}
