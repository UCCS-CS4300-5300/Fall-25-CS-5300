{% extends "base-sidebar.html" %}


{% block title %}
  AIS - AI Chat
{% endblock %}


{% block content %}
  <div class="chat-container flex-grow-1 d-flex flex-column">
    <h3 class="whiteTextOverride px-3 pt-3">Chat 10</h3>
    <div class="d-flex flex-column flex-grow-1 overflow-y-auto overflow-x-hidden">
      <div class="row" style="flex-direction: column;">
        <div id="chat-messages">
          <!-- Chat messages will populate here -->
        </div>
        {% comment %} <div class="col user-text-container">
          <div class="card user-text-bubble">
            <div class="card-body">
              <p class="card-text">I turned round, and asked him where his master was.</p>
            </div>
          </div>
        </div>
        <div class="col bot-text-container">
          <div class="card bot-text-bubble">
            <div class="card-body">
              <p class="card-text">
                There he is, said the youth, coming after you, if you will only wait.
                <br>
                <br>
                Certainly we will, said Glaucon; and in a few minutes Polemarchus appeared, and with him Adeimantus, Glauconâ€™s brother, Niceratus the son of Nicias, and several others who had been at the procession.
                <br>
                <br>
                Polemarchus said to me: I perceive, Socrates, that you and your companion are already on your way to the city.
              </p>
            </div>
          </div>
        </div> {% endcomment %}
      </div>
    </div>
    <div class="card mb-3 mt-3">
      <div class="card-body">
        <div class="d-flex">
          <textarea id="user-input" class="chat-input flex-grow-1 border-0 p-2" placeholder="Enter text here..." style="resize: none;"></textarea>
          <button class="btn btn-primary ms-2" type="button" onclick="sendMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}


{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    function sendMessage() {
      var userInput = $('#user-input').val();
      if (userInput.trim() !== '') {
        $('#chat-messages').append(
            `<div class="col user-text-container">
              <div class="card user-text-bubble">
                <div class="card-body">
                  <p class="card-text">${userInput}</p>
                </div>
              </div>
            </div>`);
        $('#user-input').val('');

        $.ajax({
          url: '{% url "chat-test" %}',
          type: 'POST',
          data: {
            'message': userInput
          },
          success: function(response) {
            $('#chat-messages').append('<p><strong>AI:</strong> ' + response.message + '</p>');
          }
        });
      }
    }

    $('#user-input').keypress(function(e) {
      if (e.which == 13) {
        sendMessage();
      }
    });
  </script>
  <script>
    const chatInput = document.getElementById('user-input');
    chatInput.addEventListener('input', function() {
      // Reset height to recalc scrollHeight
      this.style.height = 'auto';
      // Set the height based on the scrollHeight, which grows as needed
      this.style.height = this.scrollHeight + 'px';
    });
  </script>
{% endblock %}
