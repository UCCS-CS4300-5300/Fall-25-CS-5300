{% extends "base-sidebar.html" %}
{% block title %}
  AIS - {{ chat.title }} Results
{% endblock title %}
{% block content %}
  <head>
    <!--javascript source-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    {{ scores|json_script:"chart-data" }}
    <script type="text/javascript" src="/static/js/charts.js" defer></script>
  </head>
  <style>
    /* Results page specific variables */
    :root {
      --results-heading-margin-top: 2%;
      --results-heading-margin-bottom: 5%;
      --results-margin-top: 5%;
      --results-border-radius: 15px;
      --results-border-width: 3px;
      --results-chart-max-width: 500px;
      --results-chart-max-height: 450px;
      --results-feedback-max-width: 800px;
      --results-feedback-padding: 2em;
      --results-canvas-border-radius: 10px;
      --results-canvas-padding: 10px;
      --results-button-margin-top: 3rem;
      --results-button-margin-bottom: 2rem;
      --results-heading-margin-bottom-small: 1%;
    }

    .results-page-heading {
      margin-left: auto;
      margin-right: auto;
      margin-top: var(--results-heading-margin-top);
      margin-bottom: var(--results-heading-margin-bottom);
      color: var(--primary);
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    .container{
      display: flex;
      max-height: fit-content;
      justify-content: space-around;
      flex-basis: auto;
      flex-wrap: wrap;
    }
    .flex-box{
      max-height: max-content;
      max-width: max-content;
      flex: 0 1 auto;
      height: 100vh
    }
    #feedbackbox{
      border: solid;
      border-radius: var(--results-border-radius);
      border-width: var(--results-border-width);
      border-color: var(--primary-lighter);
      background-color: var(--surface);
      max-width: fit-content;
      height: fit-content;
      margin-top: var(--results-margin-top);
      flex-direction: column;
      justify-content: center;
    }
    #feedbackpara{
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      color: var(--text-primary);
      font-size: large;
      max-width: var(--results-feedback-max-width);
      padding: var(--results-feedback-padding);
    }
    #BarChart{
      width:100%;
      max-width: var(--results-chart-max-width);
      height:100%;
      max-height: var(--results-chart-max-height);
    }
    #DonutChart{
      width: auto;
      max-width: var(--results-chart-max-width);
      height:100%;
      max-height: var(--results-chart-max-height);
    }
    h1{
      margin-bottom: var(--results-heading-margin-bottom-small);
      color: var(--text-primary);
    }

    .report-button-container {
      justify-content: center;
      margin-top: var(--results-button-margin-top);
      margin-bottom: var(--results-button-margin-bottom);
    }

    /* Light mode styles (default) */
    canvas {
      background-color: var(--surface);
      border: 2px solid var(--border-light);
      border-radius: var(--results-canvas-border-radius);
      padding: var(--results-canvas-padding);
    }

    /* Dark mode support - uses data-theme attribute for consistency */
    [data-theme="dark"] .results-page-heading,
    [data-theme="dark"] h1 {
      color: var(--text-primary);
    }

    [data-theme="dark"] #feedbackbox {
      border-color: var(--primary-light);
      background-color: var(--surface);
    }

    [data-theme="dark"] #feedbackpara {
      color: var(--text-primary);
    }

    [data-theme="dark"] canvas {
      background-color: var(--surface);
      border-color: var(--border);
      border-radius: var(--results-canvas-border-radius);
      padding: var(--results-canvas-padding);
    }
  </style>
  <div id="content-scroll" class="d-flex flex-column overflow-y-auto overflow-x-hidden pe-0">
    <h1 class="results-page-heading">Interview Results</h1>
    <div class="container">
      <div class="flex-box">
        <canvas id="BarChart"></canvas>
      </div>
      <div class="flex-box">
        <canvas id="DonutChart" ></canvas>
      </div>
    </div>
    <div class="container" id="feedbackbox">
      <h1>Feedback</h1>
      <p id="feedbackpara">
        {{ feedback|linebreaksbr }}
      </p>
    </div>

    <!-- Generate Detailed Report Button -->
    <div class="container report-button-container" style="text-align: center;">
      <form method="POST" action="{% url 'generate_report' chat.id %}" id="generate_report" aria-label="Generate interview report form">
        {% csrf_token %}
        <button
          type="submit"
          class="btn btn-primary btn-lg"
          style="padding: 1rem 2rem; font-size: 1rem;"
          aria-label="Generate and download detailed interview report with section scores">
          Generate Detailed Report with Section Scores
        </button>
      </form>
      <p style="color: var(--text-secondary, #777); margin-top: 1rem; font-size: 0.9rem;">
        Click to generate a comprehensive report with detailed section scores, rationales, and export options (PDF/CSV)
      </p>
    </div>
  </div>
{% endblock content %}