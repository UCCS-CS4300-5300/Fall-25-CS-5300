{% extends "base-sidebar.html" %}
{% block title %}
  AIS - {{ chat.title }} Results
{% endblock title %}
{% block content %}
  <head>
    <!--javascript source-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    {{ scores|json_script:"chart-data" }}
    <script type="text/javascript" src="/static/js/charts.js" defer></script>
  </head>
  <style>
    .h1{
      margin-left: auto;
      margin-right: auto;
      margin-top: 2%;
      margin-bottom: 5%;
      color: var(--primary);
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    .container{
      display: flex;
      max-height: fit-content;
      justify-content: space-around;
      flex-basis: auto;
      flex-wrap: wrap;
    }
    .flex-box{
      max-height: max-content;
      max-width: max-content;
      flex: 0 1 auto;
      height: 100vh
    }
    #feedbackbox{
      border: solid;
      border-radius: 15px;
      border-width: 3px;
      border-color: var(--primary-lighter);
      background-color: var(--surface);
      max-width: fit-content;
      height: fit-content;
      margin-top: 5%;
      flex-direction: column;
      justify-content: center;
    }
    #feedbackpara{
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      color: var(--text-primary);
      font-size: large;
      max-width: 800px;
      padding: 2em;
    }
    #BarChart{
      width:100%;
      max-width:500px;
      height:100%;
      max-height: 450px;
    }
    #DonutChart{
      width: auto;
      max-width:500px;
      height:100%;
      max-height: 450px;
    }
    h1{
      margin-bottom: 1%;
      color: var(--text-primary);
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --primary: #4A9AC7;
        --primary-light: #6BB3D9;
        --primary-lighter: #87CEEB;
        --primary-dark: #1F7BA6;
        --background: #1a1a1a;
        --surface: #2d2d2d;
        --surface-hover: #3a3a3a;
        --border: #4a4a4a;
        --border-light: #3a3a3a;
        --text-primary: #e0e0e0;
        --text-secondary: #b0b0b0;
        --text-light: #808080;
      }

      #feedbackbox {
        border-color: var(--primary);
        background-color: var(--surface);
      }

      canvas {
        background-color: var(--surface);
        border-radius: 10px;
        padding: 10px;
      }
    }
  </style>
  <div id="content-scroll" class="d-flex flex-column overflow-y-auto overflow-x-hidden pe-0">
    <h1 class="h1">Interview Results</h1>
    <div class="container">
      <div class="flex-box">
        <canvas id="BarChart"></canvas>
      </div>
      <div class="flex-box">
        <canvas id="DonutChart" ></canvas>
      </div>
    </div>
    <div class="container" id="feedbackbox">
      <h1>Feedback</h1>
      <p id="feedbackpara">
        {{ feedback|linebreaksbr }}
      </p>
    </div>

    <!-- Generate Report Button -->
    <div class="container" style="justify-content: center; margin-top: 3rem; margin-bottom: 2rem;">
      <form method="post" action="{% url 'generate_report' chat.id %}">
        {% csrf_token %}
        <button type="submit" class="export-btn export-btn-generate">
          Generate Detailed Report
        </button>
      </form>
    </div>
  </div>
{% endblock content %}