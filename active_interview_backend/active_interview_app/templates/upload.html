{% extends "base.html" %}

{% block title %}
  AIS - Upload Resume
{% endblock title %}

{% block content %}
  <style>
    /* Upload page specific styles using CSS variables */
    .upload-container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 2rem;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow);
    }

    .upload-title {
      color: var(--text-primary);
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      color: var(--text-primary);
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      background: var(--background);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(31, 123, 166, 0.1);
    }

    .btn-upload {
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: var(--text-white);
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-upload:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .btn-upload:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .help-text {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    .messages {
      max-width: 600px;
      margin: 1rem auto;
      list-style: none;
      padding: 0;
    }

    .messages li {
      padding: 1rem;
      border-radius: var(--radius);
      margin-bottom: 0.5rem;
      border: 2px solid var(--border);
    }

    .messages .success {
      background: rgba(39, 174, 96, 0.1);
      color: var(--success);
      border-color: var(--success);
    }

    .messages .error {
      background: rgba(231, 76, 60, 0.1);
      color: var(--error);
      border-color: var(--error);
    }

    .messages .warning {
      background: rgba(243, 156, 18, 0.1);
      color: var(--warning);
      border-color: var(--warning);
    }

    .messages .info {
      background: rgba(52, 152, 219, 0.1);
      color: var(--info);
      border-color: var(--info);
    }
  </style>

  <div class="upload-container">
    <h2 class="upload-title">Upload Your Resume</h2>

    <form action="{% url 'upload_file' %}"
          method="post"
          enctype="multipart/form-data"
          id="uploadForm"
          onsubmit="return showUploadSpinner()">
      {% csrf_token %}

      <div class="form-group">
        <label class="form-label" for="id_file">Choose File (PDF or Word):</label>
        {{ form.file }}
        <p class="help-text">Supported formats: PDF, DOCX. Your resume will be automatically parsed by AI.</p>
      </div>

      <div class="form-group">
        <label class="form-label" for="id_title">Resume Title (Optional):</label>
        {{ form.title }}
        <p class="help-text">Give your resume a memorable name (e.g., "Software Engineer Resume 2024")</p>
      </div>

      <button type="submit" class="btn-upload" id="uploadBtn">
        <span class="loading-spinner-button"
              id="uploadSpinner"
              role="status"
              aria-hidden="true"
              style="display:none;"></span>
        <span id="uploadBtnText">Upload Resume</span>
      </button>
    </form>
  </div>

  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <script>
    /**
     * Show loading spinner when upload form is submitted
     * Prevents double-submission and provides visual feedback
     */
    function showUploadSpinner() {
      const button = document.getElementById('uploadBtn');
      const spinner = document.getElementById('uploadSpinner');
      const buttonText = document.getElementById('uploadBtnText');
      const form = document.getElementById('uploadForm');

      // Validate file is selected
      const fileInput = document.querySelector('input[type="file"]');
      if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
        alert('Please select a file to upload.');
        return false;
      }

      // Show spinner
      spinner.style.display = 'inline-block';

      // Update button text
      buttonText.textContent = 'Uploading & Parsing Resume...';

      // Disable button to prevent double-submit
      button.disabled = true;

      // Allow form submission
      return true;
    }
  </script>
{% endblock content %}
