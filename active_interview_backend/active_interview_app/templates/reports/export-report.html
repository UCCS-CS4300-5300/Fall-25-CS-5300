{% extends "base-sidebar.html" %}
{% block title %}
  AIS - Export Report - {{ chat.title }}
{% endblock title %}
{% block content %}
  <!-- All styles moved to main.css Export Report Components section -->

  <div class="export-header">
    <h1>Exportable Report: {{ chat.title }}</h1>
  </div>

  <div class="export-container">
    <!-- Export Actions -->
    <div class="export-actions">
      <a href="{% url 'download_pdf_report' chat.id %}" class="export-btn export-btn-pdf">
        Download as PDF
      </a>
      <a href="{% url 'chat-results' chat.id %}" class="export-btn export-btn-back">
        Back to Results
      </a>
    </div>

    <!-- Interview Metadata -->
    <div class="report-section">
      <h2>Interview Details</h2>
      <table class="metadata-table">
        <tr>
          <td>Interview Type:</td>
          <td>{{ chat.get_type_display }}</td>
        </tr>
        <tr>
          <td>Difficulty Level:</td>
          <td>{{ chat.difficulty }}/10</td>
        </tr>
        <tr>
          <td>Date Completed:</td>
          <td>{{ chat.modified_date|date:"F d, Y" }}</td>
        </tr>
        <tr>
          <td>Report Generated:</td>
          <td>{{ report.generated_at|date:"F d, Y \a\t h:i A" }}</td>
        </tr>
        {% if chat.job_listing %}
        <tr>
          <td>Job Position:</td>
          <td>{{ chat.job_listing.title }}</td>
        </tr>
        {% endif %}
        {% if chat.resume %}
        <tr>
          <td>Resume:</td>
          <td>{{ chat.resume.title }}</td>
        </tr>
        {% endif %}
      </table>
    </div>

    <!-- Performance Scores -->
    {% if report.overall_score %}
    <div class="report-section">
      <h2>Performance Assessment</h2>
      <div class="scores-grid">
        <div class="score-card">
          <h3>Professionalism</h3>
          <div class="score-value">{{ report.professionalism_score|default:"N/A" }}</div>
          <div class="score-rating">/100</div>
        </div>
        <div class="score-card">
          <h3>Subject Knowledge</h3>
          <div class="score-value">{{ report.subject_knowledge_score|default:"N/A" }}</div>
          <div class="score-rating">/100</div>
        </div>
        <div class="score-card">
          <h3>Clarity</h3>
          <div class="score-value">{{ report.clarity_score|default:"N/A" }}</div>
          <div class="score-rating">/100</div>
        </div>
        <div class="score-card">
          <h3>Overall Score</h3>
          <div class="score-value">{{ report.overall_score|default:"N/A" }}</div>
          <div class="score-rating">/100</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- AI Feedback -->
    {% if report.feedback_text %}
    <div class="report-section">
      <h2>AI Feedback</h2>
      <div class="feedback-text">{{ report.feedback_text }}</div>
    </div>
    {% endif %}

    <!-- Interview Statistics -->
    <div class="report-section">
      <h2>Interview Statistics</h2>
      <div class="statistics">
        <div class="stat-item">
          <strong>Total Questions Asked:</strong>
          <span>{{ report.total_questions_asked }}</span>
        </div>
        <div class="stat-item">
          <strong>Total Responses Given:</strong>
          <span>{{ report.total_responses_given }}</span>
        </div>
        {% if report.interview_duration_minutes %}
        <div class="stat-item">
          <strong>Interview Duration:</strong>
          <span>{{ report.interview_duration_minutes }} minutes</span>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Question & Answer Preview -->
    {% if report.question_responses %}
    <div class="report-section">
      <h2>Interview Questions & Responses (Preview)</h2>
      <div class="qa-section">
        {% for qa in report.question_responses|slice:":5" %}
        <div class="qa-item">
          <div class="qa-question">Q{{ forloop.counter }}: {{ qa.question|truncatewords:50 }}</div>
          <div class="qa-answer"><strong>Answer:</strong> {{ qa.answer|truncatewords:50 }}</div>
          {% if qa.score %}
          <div class="qa-answer"><strong>Score:</strong> {{ qa.score }}/10</div>
          {% endif %}
        </div>
        {% endfor %}
        {% if report.question_responses|length > 5 %}
        <p class="qa-more-info">
          And {{ report.question_responses|length|add:"-5" }} more questions... Download PDF for full report.
        </p>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Export Actions (Bottom) -->
    <div class="export-actions">
      <a href="{% url 'download_pdf_report' chat.id %}" class="export-btn export-btn-pdf">
        Download as PDF
      </a>
      <a href="{% url 'chat-results' chat.id %}" class="export-btn export-btn-back">
        Back to Results
      </a>
    </div>
  </div>
{% endblock content %}
